<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boss Respawn Tracker</title>

<style>
:root{
  --bg:#0f1115;
  --panel:#181b21;
  --row:#1f232b;
  --border:#2a2f3a;
  --green:#2ecc71;
  --orange:#f39c12;
  --red:#e74c3c;
  --text:#e6e8ee;
  --muted:#9aa0aa;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
}

.app{
  max-width:1100px;
  margin:30px auto;
  padding:20px;
}

h1{
  text-align:center;
  margin-bottom:20px;
}

.section{
  background:var(--panel);
  border-radius:14px;
  padding:14px;
  margin-bottom:25px;
  box-shadow:0 15px 40px rgba(0,0,0,.5);
}

.section h2{
  font-size:13px;
  letter-spacing:.08em;
  color:var(--muted);
  margin:0 0 12px;
  text-transform:uppercase;
}

.table{
  width:100%;
}

.header, .row{
  display:grid;
  grid-template-columns: 1.6fr 1fr 2fr 1fr;
  gap:10px;
  align-items:center;
}

.header{
  font-size:12px;
  color:var(--muted);
  padding:6px 10px;
}

.row{
  background:var(--row);
  border-radius:10px;
  padding:10px;
  margin-bottom:8px;
}

.status{
  display:flex;
  align-items:center;
  gap:6px;
  font-weight:600;
}

.dot{
  width:10px;
  height:10px;
  border-radius:50%;
}

.green{color:var(--green)}
.orange{color:var(--orange)}
.red{color:var(--red)}

small{color:var(--muted)}
</style>
</head>

<body>
<div class="app">
<h1>Boss Respawn Tracker</h1>

<div id="fixedToday" class="section">
  <h2>Fixed Respawns Today</h2>
  <div class="table">
    <div class="header">
      <div>Boss</div>
      <div>Status</div>
      <div>Respawn Time</div>
      <div>Countdown</div>
    </div>
    <div id="fixedList"></div>
  </div>
</div>

<div class="section">
  <h2>Dynamic Respawns</h2>
  <div class="table">
    <div class="header">
      <div>Boss</div>
      <div>Status</div>
      <div>Respawn Time</div>
      <div>Countdown</div>
    </div>
    <div id="dynamicList"></div>
  </div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyBbINsazxCJkEHBwySyrQ4FLZhdHC85Cyw",
  authDomain:"boss-respawn-timer.firebaseapp.com",
  projectId:"boss-respawn-timer",
  storageBucket:"boss-respawn-timer.firebasestorage.app",
  messagingSenderId:"767083470052",
  appId:"1:767083470052:web:17d7453fe66700321760f1"
});
const db = getFirestore(app);

const bosses = [
  {n:"Venatus",h:10},
  {n:"Viorent",h:10},
  {n:"Livera",h:24},
  {n:"Araneo",h:24},
  {n:"Undomiel",h:24},
  {n:"Lady Dalia",h:18},
  {n:"Ego",h:21},
  {n:"Amentis",h:29},
  {n:"General Aquleus",h:29},

  {n:"Ringor",ft:["Saturday 17:00"]},
  {n:"Roderick",ft:["Friday 19:00"]},
  {n:"Auraq",ft:["Friday 22:00","Wednesday 21:00"]},
  {n:"Nevaeh",ft:["Sunday 22:00"]}
];

const data={};

bosses.forEach(async b=>{
  const ref=doc(db,"bosses",b.n);
  const snap=await getDoc(ref);
  if(!snap.exists()) await setDoc(ref,{lastKill:0});
  onSnapshot(ref,s=>{ data[b.n]=s.data(); render(); });
});

function parseFixed(str){
  const [d,t]=str.split(" ");
  const days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
  const now=new Date();
  const date=new Date();
  date.setHours(...t.split(":").map(Number),0,0);
  let diff=(days.indexOf(d)-now.getDay()+7)%7;
  date.setDate(now.getDate()+diff);
  return date;
}

function nextSpawn(b){
  if(b.h) return (data[b.n]?.lastKill||0)+b.h*3600000;
  if(b.ft){
    const times=b.ft.map(f=>parseFixed(f).getTime());
    return times.find(t=>t>Date.now()) || times[0]+604800000;
  }
  return 0;
}

function status(ns){
  const d=ns-Date.now();
  if(d<=0) return ["Alive","green"];
  if(d<=6*3600000) return ["Respawning","orange"];
  return ["Dead","red"];
}

function countdown(ns){
  const d=ns-Date.now();
  if(d<=0) return "Now";
  const h=Math.floor(d/3600000);
  const m=Math.floor((d%3600000)/60000);
  return `${h}h ${m}m`;
}

function render(){
  fixedList.innerHTML="";
  dynamicList.innerHTML="";
  bosses.forEach(b=>{
    const ns=nextSpawn(b);
    const [s,c]=status(ns);
    const row=document.createElement("div");
    row.className="row";
    row.innerHTML=`
      <div>${b.n}</div>
      <div class="status ${c}"><span class="dot" style="background:var(--${c})"></span>${s}</div>
      <div>${new Date(ns).toLocaleString()}</div>
      <div>${countdown(ns)}</div>
    `;
    if(b.ft && parseFixed(b.ft[0]).toDateString()===new Date().toDateString()){
      fixedList.appendChild(row);
    }else if(b.h){
      dynamicList.appendChild(row);
    }
  });
}

setInterval(render,1000);
</script>
</body>
</html>
