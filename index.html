<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boss Respawn Timer</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #111;
  color: #eee;
  padding: 20px;
}

h1 {
  text-align: center;
  margin-bottom: 30px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 10px;
  border: none;
}

tr:hover {
  background: rgba(255,255,255,0.03);
}

button {
  margin-top: 6px;
  margin-right: 5px;
  padding: 6px 10px;
  cursor: pointer;
}

.section {
  max-width: 900px;
  margin: 0 auto 30px auto;
}

.section h2 {
  text-align: center;
  margin-bottom: 10px;
}
</style>
</head>

<body>

<h1>Boss Respawn Timer</h1>
<div id="bossList"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore,
  doc,
  setDoc,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyBbINsazxCJkEHBwySyrQ4FLZhdHC85Cyw",
  authDomain: "boss-respawn-timer.firebaseapp.com",
  projectId: "boss-respawn-timer",
  storageBucket: "boss-respawn-timer.firebasestorage.app",
  messagingSenderId: "767083470052",
  appId: "1:767083470052:web:17d7453fe66700321760f1",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ================= ADMIN ================= */
let isAdmin = false;
if (new URLSearchParams(window.location.search).get("admin") === "1") {
  const password = prompt("Enter admin password:");
  if (password === "UGzMamaMia") isAdmin = true;
  else alert("Wrong password. Admin disabled.");
}

/* ================= BOSSES ================= */
const bosses = [
  { name: "Venatus", level: 60, location: "Corrupted Basin", respawnHours: 10 },
  { name: "Viorent", level: 65, location: "Crescent Lake", respawnHours: 10 },
  { name: "Ego", level: 70, location: "Ulan Canyon", respawnHours: 21 },
  { name: "Livera", level: 75, location: "Protectors Ruins", respawnHours: 24 },
  { name: "Araneo", level: 75, location: "Lower Tomb of Tyriosa 1F", respawnHours: 24 },
  { name: "Undomiel", level: 80, location: "Secret Lab", respawnHours: 24 },
  { name: "Lady Dalia", level: 85, location: "Twilight Hill", respawnHours: 18 },
  { name: "General Aquleus", level: 85, location: "Lower Tomb of Tyriosa 2F", respawnHours: 29 },
  { name: "Amentis", level: 88, location: "Land of Glory", respawnHours: 29 },
  { name: "Baron Braudmore", level: 88, location: "Battlefield of Templar", respawnHours: 32 }
];

/* ================= DATA ================= */
let bossData = {};

/* ================= FIREBASE LISTENER ================= */
function listenBoss(boss) {
  const ref = doc(db, "bosses", boss.name);
  onSnapshot(ref, snap => {
    if (snap.exists()) {
      bossData[boss.name] = snap.data();
    } else {
      setDoc(ref, { lastKill: 0, respawnMs: boss.respawnHours * 3600000 });
      bossData[boss.name] = { lastKill: 0, respawnMs: boss.respawnHours * 3600000 };
    }
    render();
  });
}

/* ================= ACTIONS ================= */
async function markKilled(bossName) {
  const boss = bosses.find(b => b.name === bossName);
  await setDoc(doc(db, "bosses", boss.name), {
    lastKill: Date.now(),
    respawnMs: boss.respawnHours * 3600000
  }, { merge: true });
}

async function resetBoss(bossName) {
  await setDoc(doc(db, "bosses", bossName), {
    lastKill: 0,
    respawnMs: 0
  }, { merge: true });
}

/* ================= TIME HELPERS ================= */
function remaining(boss) {
  const d = bossData[boss.name];
  if (!d || !d.lastKill) return null;
  return d.lastKill + d.respawnMs - Date.now();
}

function format(ms) {
  if (ms <= 0) return "Spawn Window Open";
  const h = Math.floor(ms / 3600000);
  const m = Math.floor((ms % 3600000) / 60000);
  const s = Math.floor((ms % 60000) / 1000);
  return `${h}h ${m}m ${s}s`;
}

function formatDateTime(ts) {
  const d = new Date(ts);
  return d.toLocaleString("en-US", {
    weekday: "long",
    month: "short",
    day: "numeric",
    hour: "numeric",
    minute: "2-digit",
    hour12: true
  });
}

/* ================= RENDER ================= */
function render() {
  const list = document.getElementById("bossList");
  list.innerHTML = "";

  const section = document.createElement("div");
  section.className = "section";

  const table = document.createElement("table");

  const header = document.createElement("tr");
  ["Boss", "Status", "Respawn Time", "Countdown"].forEach(t => {
    const th = document.createElement("th");
    th.innerText = t;
    header.appendChild(th);
  });
  table.appendChild(header);

  [...bosses].sort((a,b) => (remaining(a) ?? 1e15) - (remaining(b) ?? 1e15))
    .forEach(boss => {
      const r = remaining(boss);
      let status = "Dead";
      let color = "#f44336";

      if (r === null || r <= 0) {
        status = "Alive";
        color = "#4caf50";
      } else if (r <= 18000000) {
        status = "Soon";
        color = "#ffc107";
      }

      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td><strong>${boss.name}</strong><br>Lv ${boss.level} — ${boss.location}</td>
        <td>
          <span style="display:inline-flex;align-items:center;gap:6px;color:${color};font-weight:bold;">
            <span style="width:10px;height:10px;border-radius:50%;background:${color};"></span>
            ${status}
          </span>
        </td>
        <td>${r === null ? "—" : formatDateTime(bossData[boss.name].lastKill + bossData[boss.name].respawnMs)}</td>
        <td>${r === null ? "Alive" : format(r)}</td>
      `;

      if (isAdmin) {
        const td = tr.lastElementChild;
        td.appendChild(document.createElement("br"));

        const k = document.createElement("button");
        k.innerText = "Boss Killed";
        k.onclick = () => markKilled(boss.name);
        td.appendChild(k);

        const rbtn = document.createElement("button");
        rbtn.innerText = "Reset";
        rbtn.onclick = () => resetBoss(boss.name);
        td.appendChild(rbtn);
      }

      table.appendChild(tr);
    });

  section.appendChild(table);
  list.appendChild(section);
}

/* ================= START ================= */
bosses.forEach(listenBoss);
setInterval(render, 1000);
</script>

</body>
</html>
