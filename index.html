<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boss Respawn Timer</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: radial-gradient(circle at top, #1b1b1b, #080808);
  color: #eee;
  padding: 40px 12px;
}

.app {
  max-width: 1100px;
  margin: auto;
  background: linear-gradient(180deg, #1e1e1e, #121212);
  border-radius: 18px;
  padding: 30px;
  box-shadow:
    0 25px 60px rgba(0,0,0,0.7),
    0 0 0 1px rgba(255,255,255,0.04);
}

h1 {
  text-align: center;
  margin-bottom: 35px;
  letter-spacing: 0.6px;
}

.section-title {
  margin: 35px 0 12px;
  font-size: 15px;
  color: #aaa;
  text-transform: uppercase;
  letter-spacing: 1px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th {
  text-align: left;
  font-size: 13px;
  color: #888;
  padding-bottom: 8px;
}

td {
  padding: 14px 6px;
  vertical-align: top;
}

tr {
  border-top: 1px solid rgba(255,255,255,0.06);
}

tr.alive {
  background: linear-gradient(90deg, rgba(76,175,80,0.15), transparent);
}

tr.soon {
  background: linear-gradient(90deg, rgba(255,193,7,0.12), transparent);
}

tr:hover {
  background-color: rgba(255,255,255,0.04);
}

.status {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-weight: bold;
}

.dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
}

button {
  margin-top: 6px;
  margin-right: 5px;
  padding: 6px 12px;
  background: #2a2a2a;
  color: #eee;
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 6px;
  cursor: pointer;
}

button:hover {
  background: #333;
}

/* ===== MOBILE ===== */
@media (max-width: 720px) {
  table, tr, td {
    display: block;
    width: 100%;
  }
  th {
    display: none;
  }
  tr {
    margin-bottom: 18px;
    border-radius: 12px;
    padding: 10px;
  }
}
</style>
</head>

<body>

<div class="app">
  <h1>Boss Respawn Timer</h1>
  <div id="bossList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore,
  doc,
  setDoc,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyBbINsazxCJkEHBwySyrQ4FLZhdHC85Cyw",
  authDomain: "boss-respawn-timer.firebaseapp.com",
  projectId: "boss-respawn-timer",
  storageBucket: "boss-respawn-timer.firebasestorage.app",
  messagingSenderId: "767083470052",
  appId: "1:767083470052:web:17d7453fe66700321760f1",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ================= ADMIN ================= */
let isAdmin = false;
if (new URLSearchParams(location.search).get("admin") === "1") {
  const pw = prompt("Admin password:");
  if (pw === "UGzMamaMia") isAdmin = true;
}

/* ================= BOSSES ================= */
const bosses = [
  { name: "Venatus", level: 60, location: "Corrupted Basin", respawnHours: 10 },
  { name: "Viorent", level: 65, location: "Crescent Lake", respawnHours: 10 },
  { name: "Ego", level: 70, location: "Ulan Canyon", respawnHours: 21 },
  { name: "Livera", level: 75, location: "Protectors Ruins", respawnHours: 24 },
  { name: "Araneo", level: 75, location: "Lower Tomb of Tyriosa 1F", respawnHours: 24 },
  { name: "Undomiel", level: 80, location: "Secret Lab", respawnHours: 24 },
  { name: "Lady Dalia", level: 85, location: "Twilight Hill", respawnHours: 18 },
  { name: "General Aquleus", level: 85, location: "Lower Tomb of Tyriosa 2F", respawnHours: 29 },
  { name: "Amentis", level: 88, location: "Land of Glory", respawnHours: 29 },
  { name: "Baron Braudmore", level: 88, location: "Battlefield of Templar", respawnHours: 32 }
];

let data = {};

/* ================= FIREBASE ================= */
function listen(boss) {
  const ref = doc(db, "bosses", boss.name);
  onSnapshot(ref, snap => {
    if (snap.exists()) data[boss.name] = snap.data();
    else {
      setDoc(ref, { lastKill: 0, respawnMs: boss.respawnHours * 3600000 });
      data[boss.name] = { lastKill: 0, respawnMs: boss.respawnHours * 3600000 };
    }
    render();
  });
}

/* ================= TIME ================= */
function remaining(b) {
  const d = data[b.name];
  if (!d || !d.lastKill) return null;
  return d.lastKill + d.respawnMs - Date.now();
}

function formatCountdown(ms) {
  if (ms <= 0) return "Spawn Window Open";
  const h = Math.floor(ms / 3600000);
  const m = Math.floor((ms % 3600000) / 60000);
  return `${h}h ${m}m`;
}

function formatDate(ts) {
  return new Date(ts).toLocaleString("en-US", {
    weekday: "short",
    month: "short",
    day: "numeric",
    hour: "numeric",
    minute: "2-digit",
    hour12: true
  });
}

/* ================= STATUS ================= */
function status(boss) {
  const r = remaining(boss);
  if (r === null || r <= 0)
    return { label: "Alive", cls: "alive", color: "#4caf50", p: 0 };
  if (r <= 18000000)
    return { label: "Soon", cls: "soon", color: "#ffc107", p: 1 };
  return { label: "Scheduled", cls: "", color: "#f44336", p: 2 };
}

/* ================= RENDER ================= */
function render() {
  const root = document.getElementById("bossList");
  root.innerHTML = "";

  const groups = {
    Alive: [],
    Soon: [],
    Scheduled: []
  };

  bosses.forEach(b => {
    const s = status(b).label;
    groups[s].push(b);
  });

  for (const title of ["Alive", "Soon", "Scheduled"]) {
    if (!groups[title].length) continue;

    const h = document.createElement("div");
    h.className = "section-title";
    h.innerText = title;
    root.appendChild(h);

    const table = document.createElement("table");

    groups[title]
      .sort((a,b)=>(remaining(a)??1e15)-(remaining(b)??1e15))
      .forEach(boss => {
        const s = status(boss);
        const r = remaining(boss);

        const tr = document.createElement("tr");
        tr.className = s.cls;
        tr.innerHTML = `
          <td>
            <strong>${boss.name}</strong><br>
            Lv ${boss.level} — ${boss.location}
          </td>
          <td>
            <span class="status" style="color:${s.color}">
              <span class="dot" style="background:${s.color}"></span>
              ${s.label}
            </span>
          </td>
          <td>${r===null?"—":formatDate(data[boss.name].lastKill + data[boss.name].respawnMs)}</td>
          <td>${r===null?"Alive":formatCountdown(r)}</td>
        `;

        if (isAdmin) {
          const td = tr.lastElementChild;
          td.appendChild(document.createElement("br"));

          const btn = document.createElement("button");
          btn.innerText = "Boss Killed";
          btn.onclick = () =>
            setDoc(doc(db,"bosses",boss.name), {
              lastKill: Date.now(),
              respawnMs: boss.respawnHours * 3600000
            },{merge:true});
          td.appendChild(btn);
        }

        table.appendChild(tr);
      });

    root.appendChild(table);
  }
}

/* ================= START ================= */
bosses.forEach(listen);
setInterval(render, 1000);
</script>

</body>
</html>
