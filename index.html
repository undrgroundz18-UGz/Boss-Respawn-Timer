<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boss Respawn Timer</title>

<style>
body{
  font-family: system-ui, Arial, sans-serif;
  background:#0f0f0f;
  color:#eee;
  padding:24px 10px;
}
.app{
  max-width:1200px;
  margin:auto;
  background:#1b1b1b;
  border-radius:20px;
  padding:24px;
  box-shadow:0 20px 60px rgba(0,0,0,.8);
}
h1{
  text-align:center;
  margin-bottom:18px;
}
.section{
  margin-top:28px;
}
.section h2{
  font-size:12px;
  letter-spacing:.08em;
  color:#aaa;
  text-transform:uppercase;
  margin-bottom:10px;
}
.header, .boss{
  display:grid;
  grid-template-columns:1.6fr .8fr 1fr 1fr;
  gap:12px;
  align-items:center;
}
.header{
  font-size:11px;
  color:#888;
  padding:8px 14px;
}
.boss{
  padding:12px 14px;
  border-radius:14px;
  margin-bottom:8px;
  background:#242424;
}
.alive{ border-left:4px solid #4caf50; }
.soon{ border-left:4px solid #ff9800; }
.dead{ border-left:4px solid #f44336; }

.status{
  font-weight:600;
}
.countdown{
  font-variant-numeric:tabular-nums;
}
button{
  background:#2b2b2b;
  border:1px solid #444;
  color:#eee;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
}
.top-controls{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
  gap:10px;
  flex-wrap:wrap;
}
</style>
</head>

<body>
<div class="app">
<h1>Boss Respawn Timer</h1>

<div class="top-controls" id="adminControls"></div>

<div id="content"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, updateDoc, onSnapshot, getDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* Firebase */
const app = initializeApp({
  apiKey:"AIzaSyBbINsazxCJkEHBwySyrQ4FLZhdHC85Cyw",
  authDomain:"boss-respawn-timer.firebaseapp.com",
  projectId:"boss-respawn-timer",
  storageBucket:"boss-respawn-timer.firebasestorage.app",
  messagingSenderId:"767083470052",
  appId:"1:767083470052:web:17d7453fe66700321760f1"
});
const db = getFirestore(app);

/* Admin */
let isAdmin=false;
if(new URLSearchParams(location.search).get("admin")==="1"){
  if(prompt("Enter admin password:")==="UGzAdmin") isAdmin=true;
}
if(isAdmin){
  document.getElementById("adminControls").innerHTML =
    `<button onclick="resetAll()">RESET ALL BOSSES</button>`;
}

/* Boss data */
const bosses = [
  {n:"Venatus",h:10},{n:"Viorent",h:10},{n:"Livera",h:24},
  {n:"Ringor",ft:["Saturday 17:00"]},
  {n:"Roderick",ft:["Friday 19:00"]},
  {n:"Auraq",ft:["Friday 22:00","Wednesday 21:00"]}
];

let data={};

/* Init Firestore */
bosses.forEach(async b=>{
  const ref=doc(db,"bosses",b.n);
  const snap=await getDoc(ref);
  if(!snap.exists()){
    await setDoc(ref,{lastKill:0,h:b.h||0,ft:b.ft||[]});
  }
  onSnapshot(ref,s=>{
    data[b.n]=s.data();
    render();
  });
});

/* Time helpers */
const days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

function parseFT(str){
  const [d,t]=str.split(" ");
  const now=new Date();
  const target=new Date();
  target.setHours(...t.split(":").map(Number),0,0);
  let diff=(days.indexOf(d)-now.getDay()+7)%7;
  if(diff===0 && target<now) diff=7;
  target.setDate(now.getDate()+diff);
  return target;
}

function nextSpawn(b){
  if(b.h) return (data[b.n]?.lastKill||0)+b.h*3600000;
  if(b.ft){
    const now=Date.now();
    const times=b.ft.map(f=>parseFT(f).getTime());
    return times.find(t=>t>now)||times[0]+7*86400000;
  }
  return 0;
}

function status(b){
  const diff=nextSpawn(b)-Date.now();
  if(diff<=0) return ["Alive","alive"];
  if(diff<=5*3600000) return ["Respawning","soon"];
  return ["Dead","dead"];
}

function countdown(b){
  const d=nextSpawn(b)-Date.now();
  if(d<=0) return "Now";
  const h=Math.floor(d/3600000);
  const m=Math.floor(d%3600000/60000);
  return `${h}h ${m}m`;
}

function spawnsToday(b){
  if(!b.ft) return false;
  const today=days[new Date().getDay()];
  return b.ft.some(f=>f.startsWith(today));
}

/* Reset all */
window.resetAll=async()=>{
  if(!confirm("Reset ALL bosses?")) return;
  const snap=await getDocs(collection(db,"bosses"));
  snap.forEach(d=>updateDoc(d.ref,{lastKill:0}));
};

/* Render */
function render(){
  const root=document.getElementById("content");
  root.innerHTML="";

  const todayFixed=bosses.filter(b=>b.ft && spawnsToday(b));
  const dynamic=bosses.filter(b=>b.h);
  const otherFixed=bosses.filter(b=>b.ft && !spawnsToday(b));

  drawSection("FIXED RESPAWNS TODAY",todayFixed);
  drawSection("DYNAMIC RESPAWNS",dynamic);
  drawSection("OTHER FIXED RESPAWNS",otherFixed);
}

function drawSection(title,list){
  if(!list.length) return;
  const root=document.getElementById("content");
  const s=document.createElement("div");
  s.className="section";
  s.innerHTML=`
    <h2>${title}</h2>
    <div class="header">
      <div>Boss</div>
      <div>Status</div>
      <div>Respawn Time</div>
      <div>Countdown</div>
    </div>`;
  list.forEach(b=>{
    const [t,c]=status(b);
    const e=document.createElement("div");
    e.className=`boss ${c}`;
    e.innerHTML=`
      <div><strong>${b.n}</strong></div>
      <div class="status">${t}</div>
      <div>${b.h?b.h+"h":(b.ft||[]).join(", ")}</div>
      <div class="countdown">${countdown(b)}</div>`;
    s.appendChild(e);
  });
  root.appendChild(s);
}

setInterval(render,1000);
</script>
</body>
</html>
