<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boss Respawn Timer</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: radial-gradient(circle at top, #1b1b1b, #0b0b0b);
  color: #eee;
  padding: 40px 15px;
}

.app {
  max-width: 980px;
  margin: auto;
  background: linear-gradient(180deg, #1f1f1f, #141414);
  border-radius: 16px;
  padding: 30px;
  box-shadow:
    0 20px 40px rgba(0,0,0,0.6),
    0 0 0 1px rgba(255,255,255,0.04);
}

h1 {
  text-align: center;
  margin-bottom: 30px;
  letter-spacing: 0.5px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th {
  text-align: left;
  font-size: 13px;
  color: #aaa;
  padding-bottom: 10px;
}

td {
  padding: 14px 6px;
  vertical-align: top;
}

tr:not(:first-child) {
  border-top: 1px solid rgba(255,255,255,0.05);
}

tr:hover {
  background: rgba(255,255,255,0.03);
}

button {
  margin-top: 6px;
  margin-right: 5px;
  padding: 6px 12px;
  background: #2a2a2a;
  color: #eee;
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 6px;
  cursor: pointer;
}

button:hover {
  background: #333;
}
</style>
</head>

<body>

<div class="app">
  <h1>Boss Respawn Timer</h1>
  <div id="bossList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore,
  doc,
  setDoc,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyBbINsazxCJkEHBwySyrQ4FLZhdHC85Cyw",
  authDomain: "boss-respawn-timer.firebaseapp.com",
  projectId: "boss-respawn-timer",
  storageBucket: "boss-respawn-timer.firebasestorage.app",
  messagingSenderId: "767083470052",
  appId: "1:767083470052:web:17d7453fe66700321760f1",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ================= ADMIN ================= */
let isAdmin = false;
if (new URLSearchParams(window.location.search).get("admin") === "1") {
  const password = prompt("Enter admin password:");
  if (password === "UGzMamaMia") isAdmin = true;
  else alert("Wrong password. Admin disabled.");
}

/* ================= BOSSES ================= */
const bosses = [
  { name: "Venatus", level: 60, location: "Corrupted Basin", respawnHours: 10 },
  { name: "Viorent", level: 65, location: "Crescent Lake", respawnHours: 10 },
  { name: "Ego", level: 70, location: "Ulan Canyon", respawnHours: 21 },
  { name: "Livera", level: 75, location: "Protectors Ruins", respawnHours: 24 },
  { name: "Araneo", level: 75, location: "Lower Tomb of Tyriosa 1F", respawnHours: 24 },
  { name: "Undomiel", level: 80, location: "Secret Lab", respawnHours: 24 },
  { name: "Lady Dalia", level: 85, location: "Twilight Hill", respawnHours: 18 },
  { name: "General Aquleus", level: 85, location: "Lower Tomb of Tyriosa 2F", respawnHours: 29 },
  { name: "Amentis", level: 88, location: "Land of Glory", respawnHours: 29 },
  { name: "Baron Braudmore", level: 88, location: "Battlefield of Templar", respawnHours: 32 }
];

let bossData = {};

/* ================= FIREBASE LISTENER ================= */
function listenBoss(boss) {
  const ref = doc(db, "bosses", boss.name);
  onSnapshot(ref, snap => {
    if (snap.exists()) {
      bossData[boss.name] = snap.data();
    } else {
      setDoc(ref, {
        lastKill: 0,
        respawnMs: boss.respawnHours * 3600000
      });
      bossData[boss.name] = {
        lastKill: 0,
        respawnMs: boss.respawnHours * 3600000
      };
    }
    render();
  });
}

/* ================= ACTIONS ================= */
async function markKilled(name) {
  const boss = bosses.find(b => b.name === name);
  await setDoc(doc(db, "bosses", name), {
    lastKill: Date.now(),
    respawnMs: boss.respawnHours * 3600000
  }, { merge: true });
}

async function resetBoss(name) {
  await setDoc(doc(db, "bosses", name), {
    lastKill: 0
  }, { merge: true });
}

/* ================= TIME ================= */
function remaining(boss) {
  const d = bossData[boss.name];
  if (!d || !d.lastKill) return null;
  return d.lastKill + d.respawnMs - Date.now();
}

function formatCountdown(ms) {
  if (ms <= 0) return "Spawn Window Open";
  const h = Math.floor(ms / 3600000);
  const m = Math.floor((ms % 3600000) / 60000);
  const s = Math.floor((ms % 60000) / 1000);
  return `${h}h ${m}m ${s}s`;
}

function formatDateTime(ts) {
  return new Date(ts).toLocaleString("en-US", {
    weekday: "long",
    month: "short",
    day: "numeric",
    hour: "numeric",
    minute: "2-digit",
    hour12: true
  });
}

/* ================= STATUS + SORT ================= */
function getStatus(boss) {
  const r = remaining(boss);

  if (r === null || r <= 0) {
    return { label: "Alive", color: "#4caf50", priority: 0 };
  }
  if (r <= 18000000) {
    return { label: "Soon", color: "#ffc107", priority: 1 };
  }
  return { label: "Scheduled", color: "#f44336", priority: 2 };
}

/* ================= RENDER ================= */
function render() {
  const list = document.getElementById("bossList");
  list.innerHTML = "";

  const table = document.createElement("table");

  const header = document.createElement("tr");
  ["Boss", "Status", "Respawn Time", "Countdown"].forEach(text => {
    const th = document.createElement("th");
    th.innerText = text;
    header.appendChild(th);
  });
  table.appendChild(header);

  [...bosses]
    .sort((a, b) => {
      const sa = getStatus(a);
      const sb = getStatus(b);
      if (sa.priority !== sb.priority) return sa.priority - sb.priority;
      return (remaining(a) ?? 1e15) - (remaining(b) ?? 1e15);
    })
    .forEach(boss => {
      const r = remaining(boss);
      const status = getStatus(boss);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>
          <strong>${boss.name}</strong><br>
          Lv ${boss.level} — ${boss.location}
        </td>
        <td>
          <span style="display:flex;align-items:center;gap:6px;color:${status.color};font-weight:bold;">
            <span style="width:10px;height:10px;border-radius:50%;background:${status.color};"></span>
            ${status.label}
          </span>
        </td>
        <td>${r === null ? "—" : formatDateTime(bossData[boss.name].lastKill + bossData[boss.name].respawnMs)}</td>
        <td>${r === null ? "Alive" : formatCountdown(r)}</td>
      `;

      if (isAdmin) {
        const td = tr.lastElementChild;
        td.appendChild(document.createElement("br"));

        const killBtn = document.createElement("button");
        killBtn.innerText = "Boss Killed";
        killBtn.onclick = () => markKilled(boss.name);
        td.appendChild(killBtn);

        const resetBtn = document.createElement("button");
        resetBtn.innerText = "Reset";
        resetBtn.onclick = () => resetBoss(boss.name);
        td.appendChild(resetBtn);
      }

      table.appendChild(tr);
    });

  list.appendChild(table);
}

/* ================= START ================= */
bosses.forEach(listenBoss);
setInterval(render, 1000);
</script>

</body>
</html>
