<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boss Respawn Timer</title>

<style>
:root{
  --bg:#0e0e10;
  --card:#16161a;
  --muted:#9a9aa2;
  --text:#f5f5f7;
  --green:#3ddc84;
  --yellow:#f4c430;
  --red:#ff5f56;
  --border:#26262b;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
}

.app{
  max-width:1100px;
  margin:auto;
  padding:24px 16px 60px;
}

h1{
  text-align:center;
  font-size:22px;
  font-weight:600;
  letter-spacing:.4px;
  margin-bottom:20px;
}

.controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:24px;
}

input,select{
  background:var(--card);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:10px;
  padding:10px 12px;
  font-size:14px;
}

.section{
  margin-top:26px;
}

.section h2{
  font-size:12px;
  letter-spacing:.12em;
  color:var(--muted);
  margin-bottom:10px;
}

.boss{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px 16px;
  display:grid;
  grid-template-columns: 1.6fr .9fr auto;
  gap:12px;
  align-items:center;
  margin-bottom:10px;
}

.name{
  display:flex;
  flex-direction:column;
  gap:4px;
}

.name strong{
  font-size:15px;
  font-weight:600;
}

.name small{
  color:var(--muted);
  font-size:12px;
}

.meta{
  display:flex;
  flex-direction:column;
  gap:6px;
  font-size:13px;
}

.badge{
  display:inline-flex;
  align-items:center;
  gap:6px;
  font-size:12px;
  font-weight:500;
}

.dot{
  width:8px;
  height:8px;
  border-radius:50%;
}

.countdown{
  font-size:16px;
  font-weight:600;
  text-align:right;
}

.actions{
  display:flex;
  gap:6px;
  margin-top:6px;
}

button{
  background:#1f1f25;
  border:1px solid var(--border);
  color:var(--text);
  font-size:12px;
  padding:5px 8px;
  border-radius:6px;
  cursor:pointer;
}

button:hover{opacity:.85}

@media(max-width:720px){
  .boss{
    grid-template-columns:1fr;
  }
  .countdown{
    text-align:left;
  }
}
</style>
</head>

<body>
<div class="app">
<h1>Boss Respawn Timer</h1>

<div class="controls">
  <input id="search" placeholder="Search boss">
  <select id="filter">
    <option value="">All</option>
    <option value="Alive">Alive</option>
    <option value="Soon">Soon</option>
    <option value="Scheduled">Scheduled</option>
  </select>
</div>

<div id="list"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, updateDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* Firebase */
const app = initializeApp({
  apiKey:"AIzaSyBbINsazxCJkEHBwySyrQ4FLZhdHC85Cyw",
  authDomain:"boss-respawn-timer.firebaseapp.com",
  projectId:"boss-respawn-timer"
});
const db = getFirestore(app);

/* Admin */
let isAdmin=false;
if(new URLSearchParams(location.search).get("admin")==="1"){
  if(prompt("Admin password")==="UGzAdmin") isAdmin=true;
}

/* Boss list (unchanged) */
const bosses = [
  {n:"Venatus",h:10,l:"Corrupted Basin"},
  {n:"Viorent",h:10,l:"Crescent Lake"},
  {n:"Livera",h:24,l:"Protector's Ruins"},
  {n:"Araneo",h:24,l:"Lower Tomb of Tyriosa 1F"},
  {n:"Undomiel",h:24,l:"Secret Lab"},
  {n:"Lady Dalia",h:18,l:"Twilight Hill"},
  {n:"Ego",h:21,l:"Ulan Canyon"},
  {n:"Amentis",h:29,l:"Land of Glory"},
  {n:"General Aquleus",h:29,l:"Lower Tomb of Tyriosa 2F"},
  {n:"Gareth",h:32,l:"Deadman 1"},
  {n:"Baron Braudmore",h:32,l:"Battlefield of Templar"},
  {n:"Catena",h:35,l:"Deadman 3"},
  {n:"Shuliar",h:35,l:"Ruins of War"},
  {n:"Larba",h:35,l:"Ruins of War"},
  {n:"Titore",h:37,l:"Deadman 2"},
  {n:"Wannitas",h:48,l:"Plateau of Revolution"},
  {n:"Metus",h:48,l:"Plateau of Revolution"},
  {n:"Duplican",h:48,l:"Plateau of Revolution"},
  {n:"Secreta",h:62,l:"Silvergrass Field"},
  {n:"Ordo",h:62,l:"Silvergrass Field"},
  {n:"Asta",h:62,l:"Silvergrass Field"},
  {n:"Supore",h:62,l:"Silvergrass Field"},
  {n:"Ringor",ft:["Saturday 17:00"],l:"Battlefield of Templar"},
  {n:"Roderick",ft:["Friday 19:00"],l:"Garbana 1"},
  {n:"Auraq",ft:["Friday 22:00","Wednesday 21:00"],l:"Garbana 2F"},
  {n:"Chaiflock",ft:["Saturday 22:00"],l:"Silvergrass Field"},
  {n:"Saphirus",ft:["Sunday 17:00","Tuesday 11:30"],l:"-"},
  {n:"Neutro",ft:["Tuesday 19:00","Thursday 11:30"],l:"Desert of Scream / Ulan"},
  {n:"Thymele",ft:["Monday 19:00","Wednesday 11:30"],l:"Twilight Hill"},
  {n:"Milavy",ft:["Saturday 15:00"],l:"Lower Tomb of Tyriosa 3F"},
  {n:"Icaruthia",ft:["Tuesday 21:00","Friday 21:00"],l:"Kransia"},
  {n:"Motti",ft:["Wednesday 19:00","Saturday 19:00"],l:"Kransia"},
  {n:"Nevaeh",ft:["Sunday 22:00"],l:"Kransia"}
];

let data={};

bosses.forEach(async b=>{
  const ref=doc(db,"bosses",b.n);
  const snap=await getDoc(ref);
  if(!snap.exists()) await setDoc(ref,{lastKill:0,ft:b.ft||[],h:b.h||0,l:b.l||"-"});
  onSnapshot(ref,s=>{data[b.n]=s.data();render();});
});

function parseTime(str){
  const [d,t]=str.split(" ");
  const days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
  const now=new Date();
  const n=new Date(); n.setHours(...t.split(":").map(Number),0,0);
  let diff=(days.indexOf(d)-now.getDay()+7)%7;
  if(diff===0 && n<now) diff=7;
  n.setDate(now.getDate()+diff);
  return n;
}

function nextSpawn(b){
  if(b.h) return (data[b.n]?.lastKill||0)+b.h*3600000;
  if(b.ft){
    const times=b.ft.map(f=>parseTime(f).getTime());
    const last=data[b.n]?.lastKill||0;
    for(let t of times) if(t>last) return t;
    return times[0]+604800000;
  }
  return Date.now();
}

function status(b){
  const d=nextSpawn(b)-Date.now();
  if(d<=0) return ["Alive","var(--green)"];
  if(d<=18000000) return ["Soon","var(--yellow)"];
  return ["Scheduled","var(--red)"];
}

function countdown(b){
  const d=nextSpawn(b)-Date.now();
  if(d<=0) return "Alive";
  const h=Math.floor(d/3600000);
  const m=Math.floor((d%3600000)/60000);
  return `${h}h ${m}m`;
}

window.killBoss=n=>updateDoc(doc(db,"bosses",n),{lastKill:Date.now()});
window.resetBoss=n=>confirm("Reset?")&&updateDoc(doc(db,"bosses",n),{lastKill:0});

const search=document.getElementById("search");
const filter=document.getElementById("filter");

function render(){
  const root=document.getElementById("list");
  root.innerHTML="";
  ["Alive","Soon","Scheduled"].forEach(sec=>{
    bosses.filter(b=>{
      if(status(b)[0]!==sec) return false;
      if(filter.value && filter.value!==sec) return false;
      if(search.value && !b.n.toLowerCase().includes(search.value.toLowerCase())) return false;
      return true;
    }).forEach(b=>{
      const [t,col]=status(b);
      root.innerHTML+=`
      <div class="boss">
        <div class="name">
          <strong>${b.n}</strong>
          <small>${b.l}</small>
          ${isAdmin?`<div class="actions">
            <button onclick="killBoss('${b.n}')">Kill</button>
            <button onclick="resetBoss('${b.n}')">Reset</button>
          </div>`:""}
        </div>
        <div class="meta">
          <span class="badge"><span class="dot" style="background:${col}"></span>${t}</span>
          <span>${b.h?b.h+"h":"Fixed"}</span>
        </div>
        <div class="countdown">${countdown(b)}</div>
      </div>`;
    });
  });
}

search.oninput=filter.onchange=render;
setInterval(render,1000);
</script>
</body>
</html>

