<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boss Respawn Timer</title>

<style>
:root{
  --bg:#0f1115;
  --panel:#181b22;
  --border:#2a2f3a;
  --text:#f1f3f6;
  --muted:#9aa0aa;

  --green:#3ddc84;
  --orange:#f4b740;
  --red:#ff5f56;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background:var(--bg);
  color:var(--text);
}

.app{
  max-width:1200px;
  margin:auto;
  padding:26px 16px 60px;
}

h1{
  text-align:center;
  font-size:22px;
  margin-bottom:20px;
  font-weight:600;
}

.controls{
  display:flex;
  gap:10px;
  margin-bottom:20px;
  flex-wrap:wrap;
}

input,select{
  background:var(--panel);
  border:1px solid var(--border);
  color:var(--text);
  padding:10px 12px;
  border-radius:10px;
  font-size:14px;
}

.section{
  margin-top:26px;
}

.section h2{
  font-size:12px;
  letter-spacing:.14em;
  color:var(--muted);
  margin-bottom:10px;
}

/* ===== Boss Row ===== */
.boss{
  display:grid;
  grid-template-columns: 1.6fr .8fr 1fr 1fr;
  gap:14px;
  align-items:center;
  padding:14px 16px;
  border-radius:14px;
  background:var(--panel);
  border:1px solid var(--border);
  margin-bottom:10px;
}

.boss.alive{border-left:5px solid var(--green);}
.boss.soon{border-left:5px solid var(--orange);}
.boss.dead{border-left:5px solid var(--red);}

.boss-name strong{font-size:15px;}
.boss-name small{
  display:block;
  font-size:12px;
  color:var(--muted);
  margin-top:2px;
}

.status{
  font-weight:600;
  font-size:13px;
  display:flex;
  align-items:center;
  gap:8px;
}

.dot{
  width:10px;
  height:10px;
  border-radius:50%;
}

.time{
  font-size:15px;
  font-weight:600;
}

.schedule{
  font-size:13px;
  color:var(--muted);
}

.actions{
  margin-top:6px;
  display:flex;
  gap:6px;
}

button{
  background:#1f2430;
  border:1px solid var(--border);
  color:var(--text);
  padding:4px 8px;
  font-size:12px;
  border-radius:6px;
  cursor:pointer;
}

@media(max-width:900px){
  .boss{grid-template-columns:1fr;}
}
</style>
</head>

<body>
<div class="app">
<h1>Boss Respawn Timer</h1>

<div class="controls">
  <input id="search" placeholder="Search boss">
  <select id="filter">
    <option value="">All</option>
    <option value="Alive">Alive</option>
    <option value="Respawning">Respawning</option>
    <option value="Dead">Dead</option>
  </select>
</div>

<div class="section">
  <h2>Fixed Respawns Today</h2>
  <div id="fixedToday"></div>
</div>

<div class="section">
  <h2>Dynamic Respawns</h2>
  <div id="dynamic"></div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, updateDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyBbINsazxCJkEHBwySyrQ4FLZhdHC85Cyw",
  authDomain:"boss-respawn-timer.firebaseapp.com",
  projectId:"boss-respawn-timer"
});
const db = getFirestore(app);

/* Admin */
let isAdmin=false;
if(new URLSearchParams(location.search).get("admin")==="1"){
  if(prompt("Admin password")==="UGzAdmin") isAdmin=true;
}

/* Boss list */
const bosses = [
  {n:"Venatus",h:10,l:"Corrupted Basin"},
  {n:"Viorent",h:10,l:"Crescent Lake"},
  {n:"Livera",h:24,l:"Protector's Ruins"},
  {n:"Araneo",h:24,l:"Lower Tomb of Tyriosa 1F"},
  {n:"Undomiel",h:24,l:"Secret Lab"},
  {n:"Lady Dalia",h:18,l:"Twilight Hill"},
  {n:"Ego",h:21,l:"Ulan Canyon"},
  {n:"Amentis",h:29,l:"Land of Glory"},
  {n:"General Aquleus",h:29,l:"Lower Tomb of Tyriosa 2F"},
  {n:"Ringor",ft:["Saturday 17:00"],l:"Battlefield of Templar"},
  {n:"Roderick",ft:["Friday 19:00"],l:"Garbana 1"},
  {n:"Auraq",ft:["Friday 22:00","Wednesday 21:00"],l:"Garbana 2F"},
  {n:"Nevaeh",ft:["Sunday 22:00"],l:"Kransia"}
];

let data={};

bosses.forEach(async b=>{
  const ref=doc(db,"bosses",b.n);
  const snap=await getDoc(ref);
  if(!snap.exists()) await setDoc(ref,{lastKill:0});
  onSnapshot(ref,s=>{data[b.n]=s.data();render();});
});

function parseTime(str){
  const [d,t]=str.split(" ");
  const days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
  const now=new Date();
  const n=new Date();
  n.setHours(...t.split(":").map(Number),0,0);
  let diff=(days.indexOf(d)-now.getDay()+7)%7;
  if(diff===0 && n<now) diff=7;
  n.setDate(now.getDate()+diff);
  return n;
}

function nextSpawn(b){
  if(b.h) return (data[b.n]?.lastKill||0)+b.h*3600000;
  if(b.ft){
    const times=b.ft.map(f=>parseTime(f).getTime());
    return times.find(t=>t>Date.now())||times[0]+604800000;
  }
}

function status(b){
  const d=nextSpawn(b)-Date.now();
  if(d<=0) return ["Alive","alive","var(--green)"];
  if(d<=18000000) return ["Respawning","soon","var(--orange)"];
  return ["Dead","dead","var(--red)"];
}

function countdown(b){
  const d=nextSpawn(b)-Date.now();
  if(d<=0) return "Now";
  const h=Math.floor(d/3600000);
  const m=Math.floor((d%3600000)/60000);
  return `${h}h ${m}m`;
}

window.killBoss=n=>updateDoc(doc(db,"bosses",n),{lastKill:Date.now()});
window.resetBoss=n=>confirm("Reset?")&&updateDoc(doc(db,"bosses",n),{lastKill:0});

const search=document.getElementById("search");
const filter=document.getElementById("filter");

function render(){
  fixedToday.innerHTML="";
  dynamic.innerHTML="";
  bosses.forEach(b=>{
    const [t,cls,col]=status(b);
    if(filter.value && filter.value!==t) return;
    if(search.value && !b.n.toLowerCase().includes(search.value.toLowerCase())) return;

    const row=`
    <div class="boss ${cls}">
      <div class="boss-name">
        <strong>${b.n}</strong>
        <small>${b.l}</small>
        ${isAdmin?`<div class="actions">
          <button onclick="killBoss('${b.n}')">Kill</button>
          <button onclick="resetBoss('${b.n}')">Reset</button>
        </div>`:""}
      </div>
      <div class="status">
        <span class="dot" style="background:${col}"></span>${t}
      </div>
      <div class="time">${new Date(nextSpawn(b)).toLocaleString()}</div>
      <div class="time">${countdown(b)}</div>
    </div>`;

    if(b.ft && parseTime(b.ft[0]).toDateString()===new Date().toDateString())
      fixedToday.innerHTML+=row;
    else if(b.h)
      dynamic.innerHTML+=row;
  });
}

search.oninput=filter.onchange=render;
setInterval(render,1000);
</script>
</body>
</html>
