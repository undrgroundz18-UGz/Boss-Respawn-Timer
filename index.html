<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boss Respawn Timer</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: radial-gradient(circle at top, #1b1b1b, #080808);
  color: #eee;
  padding: 40px 12px;
}

.app {
  max-width: 1100px;
  margin: auto;
  background: linear-gradient(180deg, #1e1e1e, #121212);
  border-radius: 18px;
  padding: 30px;
  box-shadow: 0 25px 60px rgba(0,0,0,0.7);
}

h1 {
  text-align: center;
  margin-bottom: 35px;
}

.section-title {
  margin: 30px 0 10px;
  font-size: 14px;
  color: #aaa;
  text-transform: uppercase;
}

table {
  width: 100%;
  border-collapse: collapse;
}

td {
  padding: 14px 6px;
}

tr {
  border-top: 1px solid rgba(255,255,255,0.06);
}

tr.alive {
  background: linear-gradient(90deg, rgba(76,175,80,0.18), transparent);
}

tr.soon {
  background: linear-gradient(90deg, rgba(255,193,7,0.15), transparent);
}

.status {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-weight: bold;
}

.dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
}

button {
  margin-top: 6px;
  padding: 6px 10px;
  background: #2a2a2a;
  color: #eee;
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 6px;
  cursor: pointer;
}

.history {
  font-size: 12px;
  color: #aaa;
  margin-top: 6px;
}
</style>
</head>

<body>

<div class="app">
  <h1>Boss Respawn Timer</h1>
  <div id="bossList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore,
  doc,
  setDoc,
  onSnapshot,
  updateDoc,
  arrayUnion
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ================= CONFIG ================= */
const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1451506631799083008/hGDTtPR4n3fAYR_6bC6qHyONs20YajvkmFxW56BrX09yI7HAoJ0zJOnORYwOU0QG6uZm";

/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyBbINsazxCJkEHBwySyrQ4FLZhdHC85Cyw",
  authDomain: "boss-respawn-timer.firebaseapp.com",
  projectId: "boss-respawn-timer",
  storageBucket: "boss-respawn-timer.firebasestorage.app",
  messagingSenderId: "767083470052",
  appId: "1:767083470052:web:17d7453fe66700321760f1",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ================= ADMIN ================= */
let isAdmin = false;
if (new URLSearchParams(location.search).get("admin") === "1") {
  if (prompt("Admin password") === "UGzMamaMia") isAdmin = true;
}

/* ================= BOSSES ================= */
const bosses = [
  { name: "Venatus", level: 60, location: "Corrupted Basin", respawnHours: 10 },
  { name: "Viorent", level: 65, location: "Crescent Lake", respawnHours: 10 },
  { name: "Ego", level: 70, location: "Ulan Canyon", respawnHours: 21 },
  { name: "Livera", level: 75, location: "Protectors Ruins", respawnHours: 24 },
  { name: "Araneo", level: 75, location: "Lower Tomb of Tyriosa 1F", respawnHours: 24 },
  { name: "Undomiel", level: 80, location: "Secret Lab", respawnHours: 24 },
  { name: "Lady Dalia", level: 85, location: "Twilight Hill", respawnHours: 18 },
  { name: "General Aquleus", level: 85, location: "Lower Tomb of Tyriosa 2F", respawnHours: 29 },
  { name: "Amentis", level: 88, location: "Land of Glory", respawnHours: 29 },
  { name: "Baron Braudmore", level: 88, location: "Battlefield of Templar", respawnHours: 32 }
];

let data = {};

/* ================= DISCORD ================= */
function sendDiscord(msg) {
  if (!DISCORD_WEBHOOK.startsWith("http")) return;
  fetch(DISCORD_WEBHOOK, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ content: msg })
  });
}

/* ================= TIME ================= */
function remaining(b) {
  const d = data[b.name];
  if (!d || !d.lastKill) return null;
  return d.lastKill + d.respawnMs - Date.now();
}

/* ================= STATUS ================= */
function status(b) {
  const r = remaining(b);
  if (r === null || r <= 0) return { label: "Alive", cls: "alive", color: "#4caf50" };
  if (r <= 18000000) return { label: "Soon", cls: "soon", color: "#ffc107" };
  return { label: "Scheduled", cls: "", color: "#f44336" };
}

/* ================= LISTENER ================= */
function listen(b) {
  const ref = doc(db, "bosses", b.name);
  onSnapshot(ref, snap => {
    if (!snap.exists()) {
      setDoc(ref, {
        lastKill: 0,
        respawnMs: b.respawnHours * 3600000,
        history: [],
        lastAlert: ""
      });
      return;
    }

    const prev = data[b.name];
    data[b.name] = snap.data();

    if (prev) {
      const oldStatus = status(b).label;
      const newStatus = status(b).label;

      if (oldStatus !== newStatus && newStatus !== snap.data().lastAlert) {
        sendDiscord(`**${b.name}** is now **${newStatus}**`);
        updateDoc(ref, { lastAlert: newStatus });
      }
    }

    render();
  });
}

/* ================= ADMIN ACTION ================= */
async function kill(b) {
  const ref = doc(db, "bosses", b.name);
  const now = Date.now();
  await updateDoc(ref, {
    lastKill: now,
    history: arrayUnion(`Killed at ${new Date(now).toLocaleString()}`)
  });
}

/* ================= RENDER ================= */
function render() {
  const root = document.getElementById("bossList");
  root.innerHTML = "";

  ["Alive","Soon","Scheduled"].forEach(group => {
    const list = bosses.filter(b => status(b).label === group);
    if (!list.length) return;

    const title = document.createElement("div");
    title.className = "section-title";
    title.innerText = group;
    root.appendChild(title);

    const table = document.createElement("table");

    list.forEach(b => {
      const s = status(b);
      const r = remaining(b);

      const tr = document.createElement("tr");
      tr.className = s.cls;
      tr.innerHTML = `
        <td><strong>${b.name}</strong><br>${b.location}</td>
        <td class="status" style="color:${s.color}">
          <span class="dot" style="background:${s.color}"></span>${s.label}
        </td>
        <td>${r===null?"Alive":Math.floor(r/3600000)+"h"}</td>
        <td></td>
      `;

      if (isAdmin) {
        const btn = document.createElement("button");
        btn.innerText = "Boss Killed";
        btn.onclick = () => kill(b);
        tr.lastElementChild.appendChild(btn);
      }

      table.appendChild(tr);
    });

    root.appendChild(table);
  });
}

/* ================= START ================= */
bosses.forEach(listen);
setInterval(render, 1000);
</script>

</body>
</html>
