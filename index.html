<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boss Respawn Timer</title>

<style>
body{
  font-family:system-ui,Arial;
  background:radial-gradient(circle at top,#1c1c1c,#070707);
  color:#eee;
  padding:30px 10px;
}
.app{
  max-width:1200px;
  margin:auto;
  background:linear-gradient(180deg,#1f1f1f,#101010);
  border-radius:22px;
  padding:28px;
  box-shadow:0 25px 70px rgba(0,0,0,.8);
}
h1{text-align:center;margin-bottom:25px}
.section{margin-top:30px}
.section h2{
  font-size:13px;
  color:#aaa;
  text-transform:uppercase;
  margin-bottom:10px
}
.boss{
  display:grid;
  grid-template-columns:48px 1fr auto auto;
  gap:12px;
  padding:14px;
  border-radius:14px;
  margin-bottom:10px;
  align-items:center
}
.alive{background:linear-gradient(90deg,rgba(76,175,80,.22),transparent)}
.soon{background:linear-gradient(90deg,rgba(255,193,7,.22),transparent)}
.scheduled{background:linear-gradient(90deg,rgba(244,67,54,.22),transparent)}
.icon{font-size:26px}
.status{font-weight:bold;display:flex;align-items:center;gap:6px}
.dot{width:10px;height:10px;border-radius:50%}
button{
  padding:6px 10px;
  background:#2b2b2b;
  color:#eee;
  border:1px solid rgba(255,255,255,.2);
  border-radius:6px;
  cursor:pointer
}
</style>
</head>

<body>
<div class="app">
<h1>Boss Respawn Timer</h1>
<div id="list"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore, doc, setDoc, onSnapshot, updateDoc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ================= CONFIG ================= */
const DISCORD_WEBHOOK =
"https://discord.com/api/webhooks/1451506631799083008/hGDTtPR4n3fAYR_6bC6qHyONs20YajvkmFxW56BrX09yI7HAoJ0zJOnORYwOU0QG6uZm";
const DISCORD_MENTION = "@here";

/* ================= FIREBASE ================= */
const app = initializeApp({
  apiKey:"AIzaSyBbINsazxCJkEHBwySyrQ4FLZhdHC85Cyw",
  authDomain:"boss-respawn-timer.firebaseapp.com",
  projectId:"boss-respawn-timer"
});
const db = getFirestore(app);

/* ================= ADMIN ================= */
let isAdmin=false;
if(new URLSearchParams(location.search).get("admin")==="1"){
  if(prompt("Password")==="UGzAdmin") isAdmin=true;
}

/* ================= BOSSES ================= */
const bosses = [
{n:"Venatus",h:10,l:"-"},
{n:"Viorent",h:10,l:"-"},
{n:"Livera",h:24,l:"-"},
{n:"Araneo",h:24,l:"-"},
{n:"Undomiel",h:24,l:"-"},
{n:"Lady Dalia",h:18,l:"-"},
{n:"Ego",h:21,l:"-"},
{n:"Amentis",h:29,l:"Land of Glory"},
{n:"General Aquleus",h:29,l:"-"},
{n:"Gareth",h:32,l:"Deadman 1"},
{n:"Baron Braudmore",h:32,l:"-"},
{n:"Catena",h:35,l:"Deadman 3"},
{n:"Shuliar",h:35,l:"Ruins of War"},
{n:"Larba",h:35,l:"Ruins of War"},
{n:"Titore",h:37,l:"Deadman 2"},
{n:"Wannitas",h:48,l:"Plateau of Revolution"},
{n:"Metus",h:48,l:"Plateau of Revolution"},
{n:"Duplican",h:48,l:"Plateau of Revolution"},
{n:"Secreta",h:62,l:"Silvergrass Field"},
{n:"Ordo",h:62,l:"Silvergrass Field"},
{n:"Asta",h:62,l:"Silvergrass Field"},
{n:"Supore",h:62,l:"Silvergrass Field"},

/* FIXED SCHEDULE */
{n:"Ringor",d:"Saturday",t:"17:00",l:"Battlefield of Templar"},
{n:"Roderick",d:"Friday",t:"19:00",l:"Garbana 1"},
{n:"Auraq",d:"Friday",t:"22:00",l:"Garbana 2F"},
{n:"Auraq (Wed)",d:"Wednesday",t:"21:00",l:"Garbana 2F"},
{n:"Chaiflock",d:"Saturday",t:"22:00",l:"Silvergrass Field"},
{n:"Saphirus",d:"Sunday",t:"17:00",l:"-"},
{n:"Saphirus (Tue)",d:"Tuesday",t:"11:30",l:"-"},
{n:"Neutro",d:"Tuesday",t:"19:00",l:"Desert of Scream / Ulan"},
{n:"Neutro (Thu)",d:"Thursday",t:"11:30",l:"Desert of Scream / Ulan"},
{n:"Thymele",d:"Monday",t:"19:00",l:"Twilight Hill"},
{n:"Thymele (Wed)",d:"Wednesday",t:"11:30",l:"Twilight Hill"},
{n:"Milavy",d:"Saturday",t:"15:00",l:"Land of Tyriosa 3F"}
];

let data={};

/* ================= HELPERS ================= */
function discord(msg){
 fetch(DISCORD_WEBHOOK,{
  method:"POST",
  headers:{'Content-Type':'application/json'},
  body:JSON.stringify({content:`${DISCORD_MENTION} ${msg}`})
 });
}

function nextFixed(day,time){
 const days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
 let now=new Date();
 let target=new Date();
 target.setHours(...time.split(":").map(Number),0,0);
 let diff=(days.indexOf(day)-now.getDay()+7)%7;
 if(diff===0 && target<now) diff=7;
 target.setDate(now.getDate()+diff);
 return target-now;
}

/* ================= LISTEN ================= */
bosses.forEach(b=>{
 const ref=doc(db,"bosses",b.n);
 onSnapshot(ref,s=>{
  if(!s.exists()){
   setDoc(ref,{lastKill:0,alert:""});
   return;
  }
  data[b.n]=s.data();
  render();
 });
});

/* ================= STATUS ================= */
function status(b){
 if(b.h){
  const d=data[b.n];
  if(!d||d.lastKill===0) return ["Alive","alive","#4caf50"];
  const r=d.lastKill+b.h*3600000-Date.now();
  if(r<=0) return ["Alive","alive","#4caf50"];
  if(r<=18000000) return ["Soon","soon","#ffc107"];
  return ["Scheduled","scheduled","#f44336"];
 }else{
  const r=nextFixed(b.d,b.t);
  if(r<=0) return ["Alive","alive","#4caf50"];
  if(r<=18000000) return ["Soon","soon","#ffc107"];
  return ["Scheduled","scheduled","#f44336"];
 }
}

/* ================= KILL ================= */
function kill(b){
 updateDoc(doc(db,"bosses",b.n),{
  lastKill:Date.now(),
  alert:""
 });
}

/* ================= RENDER ================= */
function render(){
 const root=document.getElementById("list");
 root.innerHTML="";
 ["Alive","Soon","Scheduled"].forEach(sec=>{
  const list=bosses.filter(b=>status(b)[0]===sec);
  if(!list.length) return;
  const s=document.createElement("div");
  s.className="section";
  s.innerHTML=`<h2>${sec}</h2>`;
  list.forEach(b=>{
   const [t,c,col]=status(b);
   const e=document.createElement("div");
   e.className=`boss ${c}`;
   e.innerHTML=`
    <div class="icon">⚔️</div>
    <div><strong>${b.n}</strong><br>${b.l}</div>
    <div class="status" style="color:${col}">
      <span class="dot" style="background:${col}"></span>${t}
    </div>
    <div>${b.h?b.h+"h":b.d+" "+b.t}</div>
   `;
   if(isAdmin){
    const btn=document.createElement("button");
    btn.textContent="Killed";
    btn.onclick=()=>kill(b);
    e.appendChild(btn);
   }
   s.appendChild(e);
  });
  root.appendChild(s);
 });
}
setInterval(render,1000);
</script>
</body>
</html>
