
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boss Respawn Timer</title>
<style>
body { font-family: system-ui, Arial, sans-serif; background: #111; color: #eee; padding: 30px 10px; }
.app { max-width: 1200px; margin: auto; background: #1e1e1e; border-radius: 22px; padding: 28px; box-shadow: 0 25px 70px rgba(0,0,0,.8); }
h1 { text-align: center; margin-bottom: 25px; color:#fff; }
.section { margin-top: 30px; }
.section h2 { font-size: 13px; color: #aaa; text-transform: uppercase; margin-bottom: 10px; }
.boss { display: grid; grid-template-columns: 1.6fr .9fr .9fr 1fr auto; gap: 12px; padding: 14px; border-radius: 14px; margin-bottom: 10px; align-items: center; background: linear-gradient(90deg, rgba(50,50,50,0.9), rgba(30,30,30,0.9)); }
.alive { background: linear-gradient(90deg, rgba(76,175,80,0.22), rgba(30,30,30,0.9)); }
.soon { background: linear-gradient(90deg, rgba(255,193,7,0.22), rgba(30,30,30,0.9)); }
.scheduled { background: linear-gradient(90deg, rgba(244,67,54,0.22), rgba(30,30,30,0.9)); }
.status { font-weight: bold; display: flex; align-items: center; gap: 6px; color:#eee; }
.dot { width: 12px; height: 12px; border-radius: 50%; }
small { color: #aaa; }
button { padding: 6px 10px; background: #2b2b2b; color: #eee; border: 1px solid rgba(255,255,255,.2); border-radius: 6px; cursor: pointer; }
input, select { padding: 8px; border-radius: 8px; border: none; font-size: 14px; }
.search-filter { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
</style>
</head>
<body>
<div class="app">
<h1>Boss Respawn Timer</h1>
<div class="search-filter">
  <input id="search" type="text" placeholder="Search boss...">
  <select id="filter">
    <option value="">All Statuses</option>
    <option value="Alive">Alive</option>
    <option value="Soon">Soon</option>
    <option value="Scheduled">Scheduled</option>
  </select>

   <button id="resetAllBtn" style="display:none">Reset All</button>
</div>
<div id="list"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, updateDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// ===== Firebase config =====
const app = initializeApp({
  apiKey:"AIzaSyBbINsazxCJkEHBwySyrQ4FLZhdHC85Cyw",
  authDomain:"boss-respawn-timer.firebaseapp.com",
  projectId:"boss-respawn-timer",
  storageBucket: "boss-respawn-timer.firebasestorage.app",
  messagingSenderId: "767083470052",
  appId: "1:767083470052:web:17d7453fe66700321760f1",
  measurementId: "G-KPH3R4MRBZ"
});
const db = getFirestore(app);
// ===========================

// Admin mode
let isAdmin = false;
if(new URLSearchParams(location.search).get("admin")==="1"){
  if(prompt("Enter admin password:")==="UGzAdmin") isAdmin=true;
}


  
// Boss list
const bosses = [
  // Hourly bosses
  {n:"Venatus",h:10,l:"Corrupted Basin"},
  {n:"Viorent",h:10,l:"Crescent Lake"},
  {n:"Livera",h:24,l:"Protector's Ruins"},
  {n:"Araneo",h:24,l:"Lower Tomb of Tyriosa 1F"},
  {n:"Undomiel",h:24,l:"Secret Lab"},
  {n:"Lady Dalia",h:18,l:"Twilight Hill"},
  {n:"Ego",h:21,l:"Ulan Canyon"},
  {n:"Amentis",h:29,l:"Land of Glory"},
  {n:"General Aquleus",h:29,l:"Lower Tomb of Tyriosa 2F"},
  {n:"Gareth",h:32,l:"Deadman 1"},
  {n:"Baron Braudmore",h:32,l:"Battlefield of Templar"},
  {n:"Catena",h:35,l:"Deadman 3"},
  {n:"Shuliar",h:35,l:"Ruins of War"},
  {n:"Larba",h:35,l:"Ruins of War"},
  {n:"Titore",h:37,l:"Deadman 2"},
  {n:"Wannitas",h:48,l:"Plateau of Revolution"},
  {n:"Metus",h:48,l:"Plateau of Revolution"},
  {n:"Duplican",h:48,l:"Plateau of Revolution"},
  {n:"Secreta",h:62,l:"Silvergrass Field"},
  {n:"Ordo",h:62,l:"Silvergrass Field"},
  {n:"Asta",h:62,l:"Silvergrass Field"},
  {n:"Supore",h:62,l:"Silvergrass Field"},

  // Fixed-time bosses
  {n:"Ringor",ft:["Saturday 17:00"],l:"Battlefield of Templar"},
  {n:"Roderick",ft:["Friday 19:00"],l:"Garbana 1"},
  {n:"Auraq",ft:["Friday 22:00","Wednesday 21:00"],l:"Garbana 2F"},
  {n:"Chaiflock",ft:["Saturday 22:00"],l:"Silvergrass Field"},
  {n:"Saphirus",ft:["Sunday 17:00","Tuesday 11:30"],l:"-"},
  {n:"Neutro",ft:["Tuesday 19:00","Thursday 11:30"],l:"Desert of Scream / Ulan"},
  {n:"Thymele",ft:["Monday 19:00","Wednesday 11:30"],l:"Twilight Hill"},
  {n:"Milavy",ft:["Saturday 15:00"],l:"Lower Tomb of Tyriosa 3F"},
  {n:"Icaruthia",ft:["Tuesday 21:00","Friday 21:00"],l:"Kransia"},
  {n:"Motti",ft:["Wednesday 19:00","Saturday 19:00"],l:"Kransia"},
  {n:"Nevaeh",ft:["Sunday 22:00"],l:"Kransia"}
];
  const resetAllBtn = document.getElementById("resetAllBtn");

if(isAdmin && resetAllBtn){
  resetAllBtn.style.display="inline-block";
  resetAllBtn.onclick = async ()=>{
    if(!confirm("RESET ALL BOSSES?")) return;
    for(const b of bosses){
      await updateDoc(doc(db,"bosses",b.n),{lastKill:0});
    }
    alert("All bosses reset.");
  };
}

let data = {};


// Initialize Firestore for all bosses
bosses.forEach(async b=>{
  const ref = doc(db,"bosses",b.n);
  const snap = await getDoc(ref);
  if(!snap.exists()){
    await setDoc(ref,{lastKill:0,ft:b.ft||[],h:b.h||0,l:b.l||"-"});
  }
  onSnapshot(ref,s=>{
    data[b.n]=s.data();
  });
});

// Timer logic
function parseTime(str){
  const [day,time] = str.split(" ");
  const days = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
  const now = new Date();
  const t = new Date(); t.setHours(...time.split(":").map(Number),0,0);
  let diff = (days.indexOf(day)-now.getDay()+7)%7;
  if(diff===0 && t<now) diff=7;
  t.setDate(now.getDate()+diff);
  return t;
}

function nextSpawn(b){
  try{
    if(b.h) return (data[b.n]?.lastKill||0)+b.h*3600000;
    if(b.ft){
      const times = b.ft.map(f=>parseTime(f).getTime());
      const lastKill = data[b.n]?.lastKill||0;
      for(let t of times) if(t>lastKill) return t;
      return times[0]+7*24*3600000;
    }
    return Date.now();
  }catch(e){ return Date.now(); }
}

function getStatus(b){
  const ns = nextSpawn(b);
  const diff = ns-Date.now();
  if(diff <=0) return ["Alive","alive","#4caf50"];
  if(diff <=18000000) return ["Soon","soon","#ffc107"];
  return ["Scheduled","scheduled","#f44336"];
}
  
  function timeUntilSpawn(b){
  return nextSpawn(b) - Date.now();
}

function formatCountdown(b){
  const diff = nextSpawn(b)-Date.now();
  if(diff <=0) return "Alive";
  const h = Math.floor(diff/3600000);
  const m = Math.floor((diff%3600000)/60000);
  return `${h}h ${m}m`;
}

// Admin actions
window.killBoss=(bossName)=>{
  let input = prompt("Enter exact kill time (YYYY-MM-DD HH:MM) or leave blank for current time:");
  let time = Date.now();
  if(input){
    const d = new Date(input);
    if(!isNaN(d)) time = d.getTime();
  }
  updateDoc(doc(db,"bosses",bossName),{lastKill:time});
};

window.resetBoss=(bossName)=>{
  if(confirm("Reset boss last kill?")){
    updateDoc(doc(db,"bosses",bossName),{lastKill:0});
  }
};

// Search/filter
const searchInput=document.getElementById('search');
const filterSelect=document.getElementById('filter');
searchInput.addEventListener('input',e=>{searchText=e.target.value.toLowerCase(); render();});
filterSelect.addEventListener('change',e=>{filterStatus=e.target.value; render();});

// Render

  const days = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

function isFixedBoss(b){
  return Array.isArray(b.ft) && b.ft.length > 0;
}

function isTodayFixedBoss(b){
  if(!isFixedBoss(b)) return false;
  const today = days[new Date().getDay()];
  return b.ft.some(f => f.startsWith(today));
}


function render(){
  const root = document.getElementById("list");
  root.innerHTML = "";

  const todayFixed = [];
  const dynamic = [];
  const otherFixed = [];

  bosses.forEach(b=>{
    if(isTodayFixedBoss(b)) todayFixed.push(b);
    else if(isFixedBoss(b)) otherFixed.push(b);
    else dynamic.push(b);
  });

  const TWELVE_HOURS = 12 * 60 * 60 * 1000;

function sortByPriority(list){
  return list.sort((a,b)=>{
    const ta = timeUntilSpawn(a);
    const tb = timeUntilSpawn(b);

    const aSoon = ta > 0 && ta <= TWELVE_HOURS;
    const bSoon = tb > 0 && tb <= TWELVE_HOURS;

    if(aSoon && !bSoon) return -1;
    if(!aSoon && bSoon) return 1;

    return ta - tb; // soonest first
  });
}

if(todayFixed.length)
  root.appendChild(renderSection("FIXED RESPAWNS TODAY", sortByPriority(todayFixed)));

if(dynamic.length)
  root.appendChild(renderSection("DYNAMIC BOSSES", sortByPriority(dynamic)));

if(otherFixed.length)
  root.appendChild(renderSection("OTHER FIXED TIMERS", sortByPriority(otherFixed)));
}

  function renderSection(title, list){
  const sec = document.createElement("div");
  sec.className = "section";

  sec.innerHTML = `
    <h2>${title}</h2>
    <div class="boss" style="font-size:12px;font-weight:600;color:#9aa0aa">
      <div>Boss</div>
      <div>Status</div>
      <div>Respawn</div>
      <div>Countdown</div>
      ${isAdmin ? "<div>Actions</div>" : ""}
    </div>
  `;

  list.forEach(b=>{
    const [t,cls,col] = getStatus(b);
    if(filterSelect.value && filterSelect.value !== t) return;
    if(searchInput.value && !b.n.toLowerCase().includes(searchInput.value.toLowerCase())) return;

    sec.innerHTML += `
      <div class="boss ${cls}">
        <div>
          <strong>${b.n}</strong>
          <small>${b.l}</small>
        </div>
        <div class="status">
          <span class="dot" style="background:${col}"></span>${t}
        </div>
        <div>${b.h ? `Every ${b.h}h` : b.ft.join(", ")}</div>
        <div>${formatCountdown(b)}</div>
        ${isAdmin ? `
        <div>
          <button onclick="killBoss('${b.n}')">Kill</button>
          <button onclick="resetBoss('${b.n}')">Reset</button>
        </div>` : ""}
      </div>
    `;
  });

  return sec;
}


setInterval(render,1000);
</script>
</body>
</html>














